        -:    0:Source:/mnt/d/Info_Facultate/Semestrul_2/OOP/Lab5/Controller/service.c
        -:    0:Graph:/mnt/d/Info_Facultate/Semestrul_2/OOP/Lab5/cmake-build-wsl-valgrind-coverage/CMakeFiles/Lab5.dir/Controller/service.c.gcno
        -:    0:Data:/mnt/d/Info_Facultate/Semestrul_2/OOP/Lab5/cmake-build-wsl-valgrind-coverage/CMakeFiles/Lab5.dir/Controller/service.c.gcda
        -:    0:Runs:1
        -:    1:#include "service.h"
        -:    2:#include "../Validator/validator.h"
        -:    3:#include "../Repository/repository.h"
        -:    4:#include "string.h"
        -:    5:#include <stdlib.h>
        -:    6:#include <stdio.h>
        -:    7:#include "mysort.h"
        -:    8:
        -:    9:/* Creeaza un obiect de tip serviciu pentru medicamente
        -:   10:*  return: un serviciu pentru medicamente
        -:   11:*/ 
function creeaza_serviciu called 7 returned 100% blocks executed 56%
        7:   12:ServiceMed* creeaza_serviciu()
        -:   13:{
        7:   14:	ServiceMed* service = malloc(sizeof(ServiceMed));
        7:   15:	if (service == NULL)
        7:   15-block  0
branch  0 taken 0 (fallthrough)
branch  1 taken 7
        -:   16:	{
    #####:   17:		perror("Couldn't allocate memory");
    %%%%%:   17-block  0
call    0 never executed
    #####:   18:		return NULL;
        -:   19:	}
        -:   20:
        7:   21:	Repo* repo = creeaza_repo();
        7:   21-block  0
call    0 returned 7
        7:   22:	if (repo == NULL)
branch  0 taken 0 (fallthrough)
branch  1 taken 7
        -:   23:	{
    #####:   24:		perror("Couldn't allocate memory");
    %%%%%:   24-block  0
call    0 never executed
    #####:   25:		return NULL;
        -:   26:	}
        -:   27:
        7:   28:	service->repo = repo;
        7:   29:	return service;
        7:   29-block  0
        -:   30:}
        -:   31:
        -:   32:/* Elibereaza memoria ocupata de serviciu
        -:   33:*  post: serviciul este distrus
        -:   34:*/
function distruge_serviciu called 7 returned 100% blocks executed 100%
        7:   35:void distruge_serviciu(ServiceMed* service)
        -:   36:{
        7:   37:	distruge_repo(service->repo);
        7:   37-block  0
call    0 returned 7
        7:   38:	free(service);
        7:   39:}
        -:   40:
        -:   41:/* Adauga un medicament la lista de medicamente pe baza datelor citite
        -:   42:*  service: serviciul de medicamente curent
        -:   43:*  cod: codul medicamentului
        -:   44:*  nume: numele medicamentului
        -:   45:*  concentratie: concentratia medicamentului
        -:   46:*  cantitate: cantitatea medicamentului
        -:   47:*  errors: va contine la iesirea din functie lista de erori cauzate de date invalide
        -:   48:*/
function adauga_medicament called 45 returned 100% blocks executed 100%
       45:   49:void adauga_medicament(ServiceMed* service, int cod, char nume[], float concentratie, int cantitate, char* errors)
        -:   50:{
       45:   51:	valideaza(cod, nume, concentratie, cantitate, errors);
       45:   51-block  0
call    0 returned 45
        -:   52:
       45:   53:	Medicament* m = creeaza_medicament(cod, nume, concentratie, cantitate);
call    0 returned 45
        -:   54:
       45:   55:	if (strlen(errors) == 0)
branch  0 taken 40 (fallthrough)
branch  1 taken 5
        -:   56:	{
       40:   57:		store(service->repo, m);
       40:   57-block  0
call    0 returned 40
       40:   58:		return;
        -:   59:	}
        -:   60:
        5:   61:	if (m != NULL)
        5:   61-block  0
branch  0 taken 5 (fallthrough)
branch  1 taken 0
        5:   62:		distruge_medicament(m);
        5:   62-block  0
call    0 returned 5
        -:   63:}
        -:   64:
        -:   65:/* Modifica numele si concentratia unui medicament care are un cod dat
        -:   66:*  service: serviciul de medicamente curent
        -:   67:*  cod: codul medicamentului
        -:   68:*  nume: noul nume
        -:   69:*  concentratie: noua concentratie
        -:   70:*  errors: va contine la iesirea din functie lista de erori cauzate de date invalide
        -:   71:*/
function modifica_medicament called 5 returned 100% blocks executed 100%
        5:   72:void modifica_medicament(ServiceMed* service, int cod, char nume[], float concentratie, char* errors)
        -:   73:{
        5:   74:	int cantitate = 10;
        5:   75:	valideaza(cod, nume, concentratie, cantitate, errors);
        5:   75-block  0
call    0 returned 5
        -:   76:
        5:   77:	int status = 1;
        5:   78:	if (strlen(errors) != 0)
branch  0 taken 3 (fallthrough)
branch  1 taken 2
        3:   79:		return;
        3:   79-block  0
        -:   80:		
        2:   81:	status = update(service->repo, cod, nume, concentratie);
        2:   81-block  0
call    0 returned 2
        -:   82:
        2:   83:	if (!status)
branch  0 taken 1 (fallthrough)
branch  1 taken 1
        1:   84:		strcat(errors, "Medicamentul cu codul dat nu exista\n");
        1:   84-block  0
        -:   85:}
        -:   86:
        -:   87:/* Sterge un medicament care are un cod dat
        -:   88:*  service: serviciul de medicamente curent
        -:   89:*  cod: codul medicamentului
        -:   90:*  return: 1 daca stergerea a avut loc, 0 in caz contrar
        -:   91:*/
function sterge_medicament called 10 returned 100% blocks executed 100%
       10:   92:int sterge_medicament(ServiceMed* service, int cod)
        -:   93:{
       10:   94:	return erase(service->repo, cod);
       10:   94-block  0
call    0 returned 10
        -:   95:}
        -:   96:
function cmpByType called 42 returned 100% blocks executed 100%
       42:   97:int cmpByType(Medicament* m1, Medicament* m2)
        -:   98:{
       42:   99:	if (strcmp(m1->nume, m2->nume) < 0 || (strcmp(m1->nume, m2->nume) == 0 && m1->cantitate < m2->cantitate))
       42:   99-block  0
branch  0 taken 27 (fallthrough)
branch  1 taken 15
       27:   99-block  1
branch  2 taken 9 (fallthrough)
branch  3 taken 18
        9:   99-block  2
branch  4 taken 6 (fallthrough)
branch  5 taken 3
       21:  100:		return 1;
       21:  100-block  0
       21:  101:	return 0;
       21:  101-block  0
        -:  102:}
        -:  103:/* Sorteaza crescator sau descrescator lista de medicamente din serviciu
        -:  104:*  service: serviciul curent de medicamente
        -:  105:*  crescator: daca este 0 indica sortare descrescatoare, altfel crescatoare
        -:  106:*/
function sorteaza_medicamente called 2 returned 100% blocks executed 100%
        2:  107:void sorteaza_medicamente(ServiceMed* service, int crescator)
        -:  108:{
        2:  109:	sort(service->repo->lista_med, cmpByType, crescator);
        2:  109-block  0
call    0 returned 2
        2:  110:}
        -:  111:
        -:  112:/* Selecteaza din lista de medicamente acelea care au cantitatea mai mica ca o valoare data
        -:  113:*  service: serviciul de medicamente curent
        -:  114:*  list: lista in care vor fi adaugate medicamentele filtrate
        -:  115:*  cantitate: valoarea data
        -:  116:*/
function filtreaza_dupa_cantitate called 1 returned 100% blocks executed 100%
        1:  117:void filtreaza_dupa_cantitate(ServiceMed* service, List* list, int cantitate)
        -:  118:{
        6:  119:	for (int i = 0; i < service->repo->lista_med->size; i++)
        1:  119-block  0
        5:  119-block  1
        6:  119-block  2
branch  0 taken 5
branch  1 taken 1 (fallthrough)
        5:  120:		if (((Medicament*)service->repo->lista_med->elems[i])->cantitate < cantitate)
        5:  120-block  0
branch  0 taken 2 (fallthrough)
branch  1 taken 3
        -:  121:		{
        2:  122:			Medicament* copy = copiaza_medicament(service->repo->lista_med->elems[i]);
        2:  122-block  0
call    0 returned 2
        2:  123:			add(list, copy);
call    0 returned 2
        -:  124:		}
        1:  125:}
        -:  126:
        -:  127:/* Selecteaza din lista de medicamente acelea care au prima litera din nume aceeasi cu o litera data
        -:  128:*  service: serviciul de medicamente curent
        -:  129:*  list: lista in care vor fi adaugate medicamentele filtrate
        -:  130:*  c: litera data
        -:  131:*/
function filtreaza_dupa_nume called 1 returned 100% blocks executed 100%
        1:  132:void filtreaza_dupa_nume(ServiceMed* service, List* list, char c)
        -:  133:{
        6:  134:	for (int i = 0; i < service->repo->lista_med->size; i++)
        1:  134-block  0
        5:  134-block  1
        6:  134-block  2
branch  0 taken 5
branch  1 taken 1 (fallthrough)
        5:  135:		if (((Medicament*)service->repo->lista_med->elems[i])->nume[0] == c)
        5:  135-block  0
branch  0 taken 2 (fallthrough)
branch  1 taken 3
        -:  136:		{
        2:  137:			Medicament* copy = copiaza_medicament(service->repo->lista_med->elems[i]);
        2:  137-block  0
call    0 returned 2
        2:  138:			add(list, copy);
call    0 returned 2
        -:  139:		}
        1:  140:}
        -:  141:
        -:  142:/* Adauga medicamente default la lista de medicamente
        -:  143:*  service: serviciul de medicamente dat
        -:  144:*/
function adauga_default called 1 returned 100% blocks executed 100%
        1:  145:void adauga_default(ServiceMed* service)
        -:  146:{
        1:  147:	char errors[] = "";
        1:  148:	adauga_medicament(service, 10, "Paracetamol", 12.11, 6, errors);
        1:  148-block  0
call    0 returned 1
        1:  149:	adauga_medicament(service, 11, "Ibuprofen", 19.1, 9, errors);
call    0 returned 1
        1:  150:	adauga_medicament(service, 12, "Aspirina", 20.2, 4, errors);
call    0 returned 1
        1:  151:	adauga_medicament(service, 13, "Omeprazol", 30.5, 10, errors);
call    0 returned 1
        1:  152:	adauga_medicament(service, 14, "Amoxicilina", 9.51, 20, errors);
call    0 returned 1
        1:  153:	adauga_medicament(service, 15, "Metformin", 20.2, 19, errors);
call    0 returned 1
        1:  154:	adauga_medicament(service, 16, "Diazepam", 15.1, 7, errors);
call    0 returned 1
        1:  155:	adauga_medicament(service, 17, "Atorvastatina", 10.78, 2, errors);
call    0 returned 1
        1:  156:	adauga_medicament(service, 18, "Furosemid", 23.11, 5, errors);
call    0 returned 1
        1:  157:	adauga_medicament(service, 19, "Cetirizina", 29.2, 21, errors);
call    0 returned 1
        1:  158:	adauga_medicament(service, 20, "Levotiroxina", 4.2, 16, errors);
call    0 returned 1
        1:  159:}
